<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Level.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sem-project</a> &gt; <a href="index.source.html" class="el_package">net.liquidpineapple.pang.screens</a> &gt; <span class="el_source">Level.java</span></div><h1>Level.java</h1><pre class="source lang-java linenums">package net.liquidpineapple.pang.screens;

import net.liquidpineapple.pang.Application;
import net.liquidpineapple.pang.gui.Board;
import net.liquidpineapple.pang.gui.NumberToken;
import net.liquidpineapple.pang.gui.ScoreSystem;
import net.liquidpineapple.pang.gui.TimeSystem;
import net.liquidpineapple.pang.objects.Ball;
import net.liquidpineapple.pang.objects.BallMovement;
import net.liquidpineapple.pang.objects.GameObject;
import net.liquidpineapple.pang.objects.Player;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import javax.imageio.ImageIO;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;

/**
 * Class that represents a level.
 * @author Govert de Gans
 * @date 2016-09-07
 */
public class Level extends Screen {

<span class="fc" id="L34">  public Level() {</span>
<span class="fc" id="L35">  }</span>

  /**
   * Method that parses a XML-file into a level.
   *
   * @param xmlFile - path/filename of the XML-file that should be parsed.
   * @return - returns a new level.
   */
  public static Level createFromXml(String xmlFile)
      throws IOException, ParserConfigurationException, SAXException {

<span class="fc" id="L46">    Level output = new Level();</span>
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">    if (createFileReader(xmlFile) != null) {</span>
<span class="nc" id="L48">      Document doc = createFileReader(xmlFile);</span>
<span class="nc" id="L49">      String backgroundPath = &quot;/sprites/&quot;</span>
<span class="nc" id="L50">          + doc.getElementsByTagName(&quot;background&quot;).item(0).getTextContent();</span>
<span class="nc" id="L51">      output.backgroundImage = ImageIO.read(Level.class.getResource(backgroundPath));</span>

<span class="nc bnc" id="L53" title="All 2 branches missed.">      for (Ball ball : loadBalls(doc.getElementsByTagName(&quot;ball&quot;))) {</span>
<span class="nc" id="L54">        output.objectList.add(ball);</span>
<span class="nc" id="L55">      }</span>

<span class="nc bnc" id="L57" title="All 2 branches missed.">      for (Player player : loadPlayer(doc.getElementsByTagName(&quot;player&quot;))) {</span>
<span class="nc" id="L58">        output.objectList.add(player);</span>
<span class="nc" id="L59">      }</span>
<span class="nc" id="L60">      TimeSystem.resetTime(loadTime(doc));</span>

<span class="nc bnc" id="L62" title="All 2 branches missed.">      for (NumberToken token : TimeSystem.getTimePlaces()) {</span>
<span class="nc" id="L63">        output.objectList.add(token);</span>
<span class="nc" id="L64">      }</span>

    }
<span class="fc bfc" id="L67" title="All 2 branches covered.">    for (NumberToken token : ScoreSystem.getPlaces()) {</span>
<span class="fc" id="L68">      output.objectList.add(token);</span>
<span class="fc" id="L69">    }</span>
<span class="fc" id="L70">    Application.lifeSystem.updateLifes();</span>
<span class="fc" id="L71">    output.objectList.add(Application.lifeSystem);</span>
<span class="fc" id="L72">    return output;</span>
  }

  /**
   * Method that reads the balls from the XML-file and parses them into Ball objects.
   *
   * @param ballList - NodeList of the different balls to be parsed.
   * @return - Arraylist with Ball objects.
   */
  public static ArrayList&lt;Ball&gt; loadBalls(NodeList ballList) {
<span class="nc" id="L82">    ArrayList&lt;Ball&gt; ballArray = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L84" title="All 2 branches missed.">    for (int i = 0; i &lt; ballList.getLength(); i++) {</span>
<span class="nc" id="L85">      Node ballNode = ballList.item(i);</span>
<span class="nc" id="L86">      Element ballElement = (Element) ballNode;</span>

<span class="nc" id="L88">      int intXpos = Integer.parseInt(ballElement.getElementsByTagName(&quot;x&quot;)</span>
<span class="nc" id="L89">          .item(0).getTextContent());</span>
<span class="nc" id="L90">      int intYpos = Integer.parseInt(ballElement.getElementsByTagName(&quot;y&quot;)</span>
<span class="nc" id="L91">          .item(0).getTextContent());</span>

<span class="nc" id="L93">      int size = Integer.parseInt(ballElement.getElementsByTagName(&quot;size&quot;).item(0)</span>
<span class="nc" id="L94">          .getTextContent());</span>

<span class="nc" id="L96">      String direction = ballElement.getElementsByTagName(&quot;direction&quot;).item(0).getTextContent();</span>
<span class="nc" id="L97">      BallMovement ballMovement = BallMovement.valueOf(direction);</span>
<span class="nc" id="L98">      Ball ball = new Ball(intXpos, intYpos, ballMovement, size);</span>
<span class="nc" id="L99">      ballArray.add(ball);</span>
    }
<span class="nc" id="L101">    return ballArray;</span>
  }

  /**
   * Method that reads the players from the XML-file and parses them into Player objects.
   * Simular to the loadBalls method
   *
   * @param playerlist - NodeList of the players that should be parsed.
   * @return - ArrayList of Player objects.
   */
  public static ArrayList&lt;Player&gt; loadPlayer(NodeList playerlist) {
<span class="nc" id="L112">    ArrayList&lt;Player&gt; playerArray = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">    for (int i = 0; i &lt; playerlist.getLength(); i++) {</span>
<span class="nc" id="L114">      Node playernode = playerlist.item(i);</span>
<span class="nc" id="L115">      Element playerElement = (Element) playernode;</span>

<span class="nc" id="L117">      int intXpos = Integer.parseInt(playerElement.getElementsByTagName(&quot;x&quot;)</span>
<span class="nc" id="L118">          .item(0).getTextContent());</span>
<span class="nc" id="L119">      int intYpos = Integer.parseInt(playerElement.getElementsByTagName(&quot;y&quot;)</span>
<span class="nc" id="L120">          .item(0).getTextContent());</span>

<span class="nc" id="L122">      Player player = new Player(intXpos, intYpos);</span>
<span class="nc" id="L123">      playerArray.add(player);</span>
    }
<span class="nc" id="L125">    return playerArray;</span>
  }

  /**
   * Method to read time form an XML-file.
   *
   * @param doc {@link Document} to be read from
   * @return - returns an int contained in the {@code &lt;time&gt;&lt;/time&gt;}
   */
  public static int loadTime(Document doc) {
<span class="nc" id="L135">    return Integer.parseInt(doc.getElementsByTagName(&quot;time&quot;).item(0).getTextContent());</span>
  }

  /**
   * Method to create a FileReader to read the XML-file.
   *
   * @param xmlFile - Path/name of the XML-file to be parsed.
   * @return - returns a new FileReader if no exception is thrown, else it will return null.
   */
  public static Document createFileReader(String xmlFile)
      throws ParserConfigurationException, SAXException {
<span class="fc" id="L146">    InputStream in = Level.class.getResourceAsStream(xmlFile);</span>
<span class="fc" id="L147">    DocumentBuilder documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();</span>

    try {
<span class="fc" id="L150">      return documentBuilder.parse(in);</span>
<span class="fc" id="L151">    } catch (IOException | IllegalArgumentException ex) {</span>
      //TODO Fix this shit
<span class="fc" id="L153">      ex.printStackTrace();</span>
<span class="fc" id="L154">      return null;</span>
    }
  }

  @Override
  /**
   * Update method for the level class.
   * Checks if the level is completed and if so, it loads a new level.
   * Updates all components in level when the level is not ended.
   */
  public void doUpdate() {
<span class="fc" id="L165">    boolean levelEnded = true;</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">    for (GameObject object : objectList) {</span>
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">      if (object instanceof Ball) {</span>
<span class="nc" id="L168">        levelEnded = false;</span>
      }
<span class="fc" id="L170">    }</span>

<span class="pc bpc" id="L172" title="1 of 2 branches missed.">    if (levelEnded) {</span>
      try {
<span class="fc" id="L174">        nextLevel();</span>
<span class="nc" id="L175">      } catch (ParserConfigurationException | SAXException ex) {</span>
<span class="nc" id="L176">        ex.printStackTrace();</span>
<span class="pc" id="L177">      }</span>
    } else {
<span class="nc" id="L179">      new ArrayList&lt;&gt;(objectList).forEach(GameObject::doUpdate);</span>
    }
<span class="fc" id="L181">  }</span>

  /**
   * Attempst to load the new level (WIP).
   */
  private void nextLevel() throws ParserConfigurationException, SAXException {
<span class="fc" id="L187">    Board currentBoard = Application.getBoard();</span>
<span class="fc" id="L188">    currentBoard.setLevelCount(currentBoard.getLevelCount() + 1);</span>
<span class="fc" id="L189">    Screen newScreen = null;</span>
<span class="fc" id="L190">    String levelLocation = &quot;/levels/level&quot; + currentBoard.getLevelCount() + &quot;.xml&quot;;</span>
<span class="fc bfc" id="L191" title="All 2 branches covered.">    if (createFileReader(levelLocation) != null) {</span>
      try {
<span class="fc" id="L193">        newScreen = Level.createFromXml(&quot;/levels/level&quot; + currentBoard.getLevelCount() + &quot;.xml&quot;);</span>
<span class="nc" id="L194">      } catch (IOException ex) {</span>
<span class="nc" id="L195">        ex.printStackTrace();</span>
<span class="pc" id="L196">      }</span>
    } else {
      //set behaviour when all levels have been completed here.
<span class="fc" id="L199">      newScreen = new WinScreen();</span>
    }
<span class="fc" id="L201">    currentBoard.changeScreen(newScreen);</span>
<span class="fc" id="L202">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>